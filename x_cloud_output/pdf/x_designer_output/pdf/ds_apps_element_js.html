<div class="post-header">
    <h1 class="post-title-main" id="ds_apps_element_js.html">Add JavaScript to an Element</h1>
</div>

<div class="post-content">

    
    <div class="summary">Adding JavaScript to your element is easy, and allows for more powerful elements.</div>
    
    <p>You can use JavaScript to add events, interactions, and effects to your element.</p>

<div class="Notice type_info" role="alert">
	<b>Note:</b> If your element doesn’t need JavaScript, you still must create this file and leave it blank.
</div>

<h2 id="editor-vs-published-scripts">Editor vs. Published Scripts</h2>

<p>Your JavaScript files live in the <a href="ds_apps_element_folders.html"><code class="highlighter-rouge">js</code> directory</a> for your element. You need to create a file named <code class="highlighter-rouge">element.js</code>, which will be used for both the editor and the published site. You can also provide an <code class="highlighter-rouge">editor_element.js</code> file to be used only within the editor. This allows you to specify different events and interactions for the site owner when working with your element in the editor. This may be necessary when your element requires major interactivity with the user on a published site, as the element placeholder in the editor can handle only basic interaction, such as direct editing.</p>

<h2 id="javascript-structure">JavaScript Structure</h2>
<p>We provide a <a href="http://backbonejs.org/#View">Backbone View</a> as the base class (<code class="highlighter-rouge">PlatformElement.js</code>) for you to extend to create your element’s JavaScript.  This allows you to easily define events for your element using the events hash.</p>

<div class="Notice type_info" role="alert">
	<b>Note:</b> If your element doesn’t need JavaScript, you still must create this file (but you can leave it blank).
</div>

<p>​There are two ways for you to define your element javascript code: extending the base class and providing all your JavaScript in that extended class, or using a self executing anonymous function that allows more flexibility as to where the script lives. Both methods can refer to jQuery (use <code class="highlighter-rouge">$</code>) and Underscore (use <code class="highlighter-rouge">_</code> ).</p>

<h3 id="base-class-extension">Base class extension</h3>
<p>To extend the base class, call the <code class="highlighter-rouge">extend</code> method of <code class="highlighter-rouge">PlatformElement</code>. With this method, all code must be contained within your extended class. You specify an <code class="highlighter-rouge">initialize</code> method that gets called once your element is placed on the DOM and is ready for event bindings and interaction.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"click .button"</span><span class="p">:</span> <span class="s2">"clickButton"</span>
    <span class="p">},</span>

    <span class="na">clickButton</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Button Clicked!"</span><span class="p">);</span>
        <span class="c1">// You can use $ (jQuery) and _(Underscore) in here!</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h3 id="self-executing-anonymous-function">Self-executing anonymous function</h3>
<p>If you use the self executing anonymous function, you can move code outside of the element definition, and you have a bit more flexibility in terms of where you place your code.  You can use the example below as a starting point for your element.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="c1">// You can use $ (jQuery) and _ (Underscore) in here!</span>
    <span class="c1">// Perform any setup you might need</span>
    <span class="kd">var</span> <span class="nx">example</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

    <span class="c1">// Prepare the element</span>
    <span class="kd">var</span> <span class="nx">myElement</span> <span class="o">=</span> <span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="na">initialized</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Element Ready"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="c1">// do some work</span>
    <span class="nx">myElement</span><span class="p">.</span><span class="nx">example</span> <span class="o">=</span> <span class="nx">example</span><span class="p">;</span>

<span class="c1">// All done</span>
    <span class="k">return</span> <span class="nx">myElement</span><span class="p">;</span>
<span class="p">})</span> <span class="p">();</span></code></pre></figure>

<div class="alert alert-info" role="alert"><i class="fa fa-info-circle"></i> <b>Note:</b> All URLs must use the HTTPS protocol.</div>

<h2 id="access-settings">Access Settings</h2>
<p>Within your JavaScript, you can access element settings using <code class="highlighter-rouge">this.settings</code>, which acts as a <a href="http://backbonejs.org/#Model">Backbone Model</a>, and the <code class="highlighter-rouge">get</code> method.  Any settings that are defined as private in your <code class="highlighter-rouge">manifest.json</code> will not be available to your JavaScript on the published site.  This is for security reasons, and allows you to place API Keys in your settings without exposing them to site visitors.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="nx">initialize</span><span class="p">.</span><span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<h2 id="update-settings">Update Settings</h2>
<p>When in the editor, your JavaScript can update the element settings also using the Backbone Model syntax:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"John Doe"</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span><span class="p">.</span><span class="nx">save</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="c1">// This code will run once the settings are successfully saved</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<div class="Notice type_info" role="alert">
	<b>Note:</b> You can only update settings from the editor and not from the published site.  Attempting to update from the published site causes the <code class="highlighter-rouge">save</code> call to fail resolving.  You can catch this with the <code class="highlighter-rouge">.fail</code> chained method on your <code class="highlighter-rouge">save</code> call.
</div>

<p>​Once you update settings, you need to re-render the page for the new values to be applied.</p>

<h2 id="rerender-to-apply-changes">Rerender to Apply Changes</h2>
<p>If your element updates its settings, you need to trigger a re-render before the new settings are properly applied to the element in the editor.  We’ve overridden the <code class="highlighter-rouge">render</code> method of your element JavaScript.  Simply call <code class="highlighter-rouge">render</code> to trigger a rerender.  Once the rerender is complete, your element is in a fresh new state, and your <code class="highlighter-rouge">initialize</code> method is rerun.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">events</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"click .button"</span><span class="p">:</span> <span class="s2">"clickButton"</span>
    <span class="p">},</span>

    <span class="na">clickButton</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span> <span class="c1">// Triggers a re-render</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<div class="Notice type_info" role="alert">
	<b>Note:</b> Triggering a rerender destroys the DOM nodes for your element and regenerates them.  This means that triggering the <code class="highlighter-rouge">render</code> method will interrupt any other JavaScript flow within the method, essentially acting as a return.
</div>

<div class="Notice type_info" role="alert">
	<b>Note:</b> Calling the <code class="highlighter-rouge">render</code> method from within your <code class="highlighter-rouge">initialize</code> method will cause an infinite loop. This is because the editor will destroy and regenerate the DOM nodes repeatedly. Be careful not to do this!
</div>

<h2 id="include-additional-data">Include Additional Data</h2>
<p>You can access additional data in your JavaScript. This data is accessed similarly to settings, using mustache . You can access the following:</p>

<ul>
  <li><code class="highlighter-rouge">assets_path</code>: The HTTP accessible root path to your elements’ assets folder, in protocol-agnostic form.  The path contains the trailing slash.  It is accessible as a property of your element:</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">assets_path</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<ul>
  <li><code class="highlighter-rouge">element_id</code>, <code class="highlighter-rouge">user_id</code>, <code class="highlighter-rouge">site_id</code>: We also expose some identifying information about the current user, site, and element. The <code class="highlighter-rouge">element_id</code>  is the unique element ID for this element instance. The <code class="highlighter-rouge">user_id</code> and the <code class="highlighter-rouge">site_id</code> are the unique identifiers for the current user and site.</li>
</ul>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">PlatformElement</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
    <span class="na">initialize</span><span class="p">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">element_id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></figure>

<div class="Notice type_info" role="alert">
	<b>Note:</b> We cannot guarantee that <code class="highlighter-rouge">element_id</code> and <code class="highlighter-rouge">site_id</code> will be universally unique. We recommend that you use a composite key for any storage you may be doing on your servers or services!
</div>


</div>
